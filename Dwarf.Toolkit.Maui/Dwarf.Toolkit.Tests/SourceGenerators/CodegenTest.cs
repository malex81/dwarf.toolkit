using Dwarf.Toolkit.Maui.SourceGenerators;
using NUnit.Framework;

namespace Dwarf.Toolkit.Tests.SourceGenerators;

[TestFixture]
internal partial class CodegenTest
{
	[TestCase]
	public void SimpleBindableProperty()
	{
		var source = """
			using Microsoft.Maui.Controls;
			using Dwarf.Toolkit.Maui;

			namespace MyApp;

			partial class SimpleObject : BindableObject
			{
				[BindableProperty]
				public partial string MyProp { get; set; }
			}
			""";

		var result = """
			// <auto-generated/>
			#pragma warning disable
			#nullable enable
			namespace MyApp;
			/// <inheritdoc/>
			partial class SimpleObject
			{
				public static readonly BindableProperty MyPropProperty = BindableProperty.Create(nameof(MyProp), typeof(string), typeof(SimpleObject));

				[global::System.CodeDom.Compiler.GeneratedCode("Dwarf.Toolkit.Maui.SourceGenerators.BindablePropertyGenerator", <ASSEMBLY_VERSION>)]
				[global::System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverage]
				partial string MyProp
				{
					get => (static)GetValue(MyPropProperty);
					set => SetValue(MyPropProperty, value);
				}
			}
			""";

		VerifyGenerateSources(source, [new BindablePropertyGenerator()], ("MyApp.SimpleObject.g.cs", result));
	}
}